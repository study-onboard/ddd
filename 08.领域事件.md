# 八、领域事件

经典的观察者模式，一般用于维护领域系统的一致性，这个一致性一般是最终一致性。一般有以下场景：

1. 本领域内，某实体变更后发出领域事件，其它关联实体监听该事件，更新其关联业务属性。
2. 多限界上下文，核心域实体变更通过消息队列发出领域事件，所有相关的支撑域针对该事件做出相关的反应。
3. 清除分布式缓存或者应用内置缓存。

**领域事件分类**

1. 本地领域事件，即由应用内的其它组件消费的事件
2. 分布式领域事件，即由应用外的其它域的组件消费的事件



**领域事件的存储**

1. 将领域事件进行存储有利于事件追踪
2. 领域事件的存储包括下面方面：
   * 事件存储
   * 事件订阅方处理存储
   * 事件类别定义，即定义事件应该由至少多少个订阅方处理完成方可认为领域事件完全被处理完成。这主要是应对分布式系统中面向失败的设计。

> 这个仍需要用代码来描述，书上讲了一大堆的设计要点，这些都需要用实例来证明其可行性。
>
> 另外也要利用一种可靠的MQ，否则无从谈起。



**分布式领域事件的设计思路**

1. 领域层向领域事件管理组件发送领域事件
2. 领域事件管理组件调用支撑域领域事件微服务存储事件（创建），如果失败，记录在本地存储中，以备再次发布（需要一个机制重试，如分布式任务调度系统xxljob之类的）
3. 领域事件管理组件向本地发布事件，由本地优先处理事件
4. 领域事件管理组件向外部发布事件（通过ＭＱ，异步）


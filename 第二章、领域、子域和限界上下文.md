# 第二章、领域、子域和限界上下文

## 一、概念与理解

### 1. 领域、子域

领域可以理解为所要面和的客户要开发的软件的业务范围和业务逻辑。

由于领域很大，所以只能关注领域的的某个方面，并进行相关的软件建模，这个软件模型又称之为“领域模型”。

领域又可按照业务归类逻辑拆分为`相互分离`的子领域。

为什么要相互分离？理解一下面向接口的编程就可以了，子域与子域间通过接口关联通信，隐藏子域内部细节。



### 2. 限界上下文

书上写得太过垃圾，真没能看懂他想表达什么。

不过从一些语句中可以理解得出来：

1. 书上的图２.1上的包含４个子域的限界上下文是错误的实践
2. 标准是`一个子域对应一个限界上下文`，也就是说，我们拆分领域为分离的子域，也就是在拆限界上下文
3. 在限界上下文内，各种术语、流程、代号有固定的意思。而这些术语、流程、代号在别的限界上下文就可能不是一样的意思。所以才会使用限界上下文。举个例子：在软件开发范畴内（限界上下文），质量是代码经过单元测试和集成测试、自动化测试、安全测试等一系统测试的软件，如果在建筑工程范畴，这个质量就是另一种意思了。所以这就是为什么图2.1包含４个子域的限界上下文不是一个好的实践，很简单的例子，“顾客”在订单子域是下单付费的登录用户，而在产品目录子域，“顾客”则是所有浏览商品的用户，包括匿名未登录的和已登录的用户，同一个术语在不同的子域里有不同的意思，所以这两个子域不应规划到一个限界上下文里。
4. 甚至一个子域可能包括多个限界上下文，理论上讲应该将这个子域拆分为更细的子域，以达到一个子域对应一个限界上下文的标准。
5. 可以粗粗地认为限界上下文就是子域关联的一系列的术语、流程和代号。
6. 当关注到一个子域时，该子域即是核心域，而与其集成的支撑域和通用子域，为了支持该核心域业务方面，该核心域的限界上下文会包含支撑域、通用子域的一部分或全部。



限界上下文包含哪些领域模型呢？

1. 模块
2. 聚合
3. 领域事件
4. 领域服务
5. ....

限界上下文是一个显式的边界，领域模型便存在于这个边界之内。你可以认为他是一个namespace。

限界上下文并不只是局限于容纳模型，它通常标定了一个系统、一个应用程序或者一种业务服务。





### 3. 核心域、支撑域、通用子域

1. 核心域，可以理解为领域中你关注的问题空间的业务子域。比如说，电商系统领域，订单子域是关于订单业务的，所以是核心域。
2. 支撑域，可以理解为领域中涉及业务但是不是核心业务的子域。比如说，商品品类子域，它是关于业务的，但是相对于核心域来说，它不是核心业务，但是它给核心域提供了商品查询支持，所以它是支撑域。
3. 通用子域，被所有子域需要的子域，一般只提供数据、接口，但不是涉及业务相关。比如说帐号子域，它并不涉及电商的业务，但是却给核心子域提供了帐号相关的数据资料。它属于工具类型，可以理解为对核心域提供接口支持的都可以称之为通用子域。

> 核心域是相对的。
>
> 当你要解决什么问题，那么该问题对应的子域就是核心域，所以对该子域提供支持的都是支撑域和通用子域。
>
> 比方说，在开发ＤＳＲ时，因为我们关注点在ＤＳＲ上，那么ＤＳＲ就是我们关注的领域的核心域，而给他提供存储服务和后端系统调用的ＷＣＡＳ，都是支撑域，而帐号系统则是通用子域。
>
> 又比方说，ＷＣＡＳ团队关注点在ＷＣＡＳ上，这样ＷＣＡＳ就是他们的核心域，而ＤＳＲ是他们的消费者，顶多算是一个支撑域。





## 二、理解案例

说实在的，这本书的作者用的案例和文笔真的太烂，真真是看不懂！勉强靠猜理解。

### p56

1. 正方形的那个是领域模型，框着的是限界上下文。
2. 根据关注点的不同，核心域也就不同。
3. 对于`身份与访问上下文`，关注的是用户的身份认证及权限，而权限的设计则是基于角色的方式。举个例子，我们给一个帐号一个像主持人这样的角色，我们只需要建立一个帐号，并将这个主持人角色绑定给他。因为关注点是帐号及权限，所以在这个核心域中领域模型只有帐号和权限两者。而在`协作上下文`中，主持人是该子域的领域模型，一个主持人是一个绑定了主持人角色的帐号，因为关注点是主持人相关的模型属性和行为，所以该领域模型记录了帐号ＩＤ之外的与帐号无关而与主持人有关的业务属性和业务行为。

> 限界上下文划分是否合理的标准是：一个业务实体在限界上下文内是否存在两种不同的解释，如果是，则表示该限界上下文需要进一步地拆分。



### p67

这个案例写得太不好理解了。其实整个的意思就是，不要将别的限界上下文的领域模型放到本限界上下文中。

例子是这样的，已经划分出`认证与权限`和`协作`上下文，`认证与权限`上下文负责帐号是否有权限做某事，比方说在这里是是否有权限在`协作`上下文中发布一个帖子。

常规的做法是，在`协作`上下文中引入`认证与权限`上下文的模型，使用该模型来判断当前帐号是否有权限发布帖子。这就污染了`协作`限界上下文。`协作`上下文只关心谁、发布了帖子，而关注是否有权限发布帖子的则是`认证与权限`这个限界上下文。

书中罗里罗索地讲了好几页，其实大概意思是：

1. 将权限验证分离出当前子域，通过应用底层框架机制（上下文边界内）调用`认证与权限`上下文接口验证权限，而不应将`认证与权限`的模型引入到本域中。
2. 总体意思就是，本域只关注本域的业务，如果涉及它域（支撑域、通用域），则调用接口。



## 三、总结

其实就几个概念：

1. 核心域、支撑域、通用域。核心域就是关注的问题空间，你项目关注的核心业务是什么，你的核心域就是什么。所以随着关注的改变，核心域也随之改变。
2. 限界上下文。核心域相关的边界，在该边界内，术语、流程等有统一的意思。可以简单地认为核心域里某个业务方面。
3. 核心域只关心自己的业务模型，所以不应将其它域的业务模型引入进来。如果需要其它域的支撑，例如判断是否有能力做某事等，则应该调用相关支撑域的接口（集成）完成相关操作，而不应该引入业务模型成为本域的模型。

这个第二章作者写得很失败，就像个糟糕的推销员不断地抛自己的产品有多好却说不好好在哪里。所以这一章很多概念没细看，因为发现细看也没用，他所讲述的东西我都没接触过，并且这些东西是后续几章的内容，所以看起来相当费力不讨好。

知识是逐渐累积起来的，就像建楼一下，一层一层地建。如果有个工程建造师告诉正在建一楼的你２２楼该怎么装修，你听得进去吗？
